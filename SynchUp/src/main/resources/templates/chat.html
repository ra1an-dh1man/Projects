<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SynchUp App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.1/stomp.min.js"></script>

    <style>
        body{
            background-image: url("/media/background.png");
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            background-color: #f0f0f0;
            color: #222;
        }
        .container {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 10px 10px 10px rgba(82, 5, 249, 0.1);
        }


        .heading {
            text-align: center;
            margin-top: 20px;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
            font-weight: bold;
            font-size: 3rem;
            color: #1e6bee;
            text-shadow: 3px 3px 6px rgba(117, 80, 197, 0.3);
}

        #warning {
            text-align: center;
            color: red;
            font-weight: bold;
            margin-bottom: 10px;
        }

        input[type="text"] {
            box-shadow: 10px 10px 10px rgba(82, 5, 249, 0.1);
}

        button {
            margin-left: 5px;
            box-shadow: 10px 10px 10px rgba(82, 5, 249, 0.1);
        }

        #chat {
            height: 300px;
            overflow-y: auto;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
        }

        #typingStatus {
            min-height: 20px;
            font-style: italic;
            color: #555;
            margin-bottom: 10px;
        }

        #chat {
    background: #a6c1e6; /* soft blue */
    border: 1px solid #b3c6e0;
    border-radius: 8px;
    padding: 16px;
    height: 300px;
    overflow-y: auto;
}

        .logo-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        #logo {
            height: 50px;
            width: 50px;
            margin-top: 15px;
            border-radius: 15px;
        }

        #send-logo {
            height: 20px;
            width: 20px;
            margin-bottom: 3px;
        }


    </style>
</head>
<body>
<div class="logo-header">
    <img id="logo" src="/media/logo.png" alt="SynchUp Logo">
    <h1 class="heading">SynchUp</h1>
</div>
<div class="container mt-4">
    <div id="chat" style="height: 55vh">
        <p id="warning">Make sure to keep messages family friendly</p>
    </div>

    <div id="typingStatus"></div>

    <form id="chatForm" onsubmit="sendMessage(); return false;">
        <div class="input-group mb-3">
            <input id="senderInput" type="text" class="form-control" placeholder="Type your name here..." required>
        </div>

        <div class="input-group mb-3">
            <input id="messageInput" type="text" class="form-control" placeholder="Type your message here..." required>
            <div class="input-group-append">
                <button id="sendMessage" class="btn"><img src="/media/send.png" alt="Send" id="send-logo"></button>

            </div>
        </div>
    </form>
</div>

<script>
    var stompClient;

    function setConnected(connected) {
        document.getElementById('sendMessage').disabled = !connected;
    }

    function connect() {
        var socket = new SockJS('/chat');
        stompClient = Stomp.over(socket);

        stompClient.connect({}, function (frame) {
            setConnected(true);

            // Subscribe to chat messages
            stompClient.subscribe('/topic/messages', function (message) {
                showMessage(JSON.parse(message.body));
            });

            // Subscribe to typing notifications
            stompClient.subscribe('/topic/typing', function(message) {
                var data = JSON.parse(message.body);
                var typingDiv = document.getElementById('typingStatus');
                var currentUser = document.getElementById('senderInput').value.trim();

                if(data.typing && data.sender !== currentUser) {
                    typingDiv.textContent = data.sender + " is typing...";
                } else {
                    typingDiv.textContent = "";
                }
            });

            // Attach input listener after stomp is connected
            var messageInput = document.getElementById('messageInput');
            messageInput.addEventListener('input', function() {
                var sender = document.getElementById('senderInput').value.trim();
                if(sender === "") return;

                var typingMessage = { sender: sender, typing: true };
                stompClient.send('/app/typing', {}, JSON.stringify(typingMessage));

                clearTimeout(messageInput.typingTimeout);
                messageInput.typingTimeout = setTimeout(function() {
                    var stopTypingMessage = { sender: sender, typing: false };
                    stompClient.send('/app/typing', {}, JSON.stringify(stopTypingMessage));
                }, 1000);
            });

            // Attach send button event
            document.getElementById('sendMessage').onclick = sendMessage;
        });
    }

    function showMessage(message) {
        var chat = document.getElementById('chat');
        var messageElement = document.createElement('div');
        messageElement.textContent = message.sender + ': ' + message.content;
        messageElement.className = "border-bottom mb-1";
        chat.appendChild(messageElement);
        chat.scrollTop = chat.scrollHeight;
    }

    function sendMessage() {
        var senderInput = document.getElementById('senderInput');
        var messageInput = document.getElementById('messageInput');
        var warning = document.getElementById('warning');

        var sender = senderInput.value.trim();
        var content = messageInput.value.trim();

        if (!sender || !content) {
            alert("Please enter both your name and a message before sending!");
            return;
        }

        var chatMessage = { sender: sender, content: content };
        stompClient.send('/app/sendMessage', {}, JSON.stringify(chatMessage));
        messageInput.value = '';

        if (warning) warning.style.display = "none";
    }

    // Connect on page load
    window.onload = connect;
</script>
</body>
</html>
